---
title: "Assignment 4 - Aquaculture"
author: "Gabrielle"
date: '2022-11-09'
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,message=FALSE,warning = FALSE,results=FALSE)
library(tidyverse)
library(here)
library(ggpubr) # for some graphic applications that extend ggplot2
library(janitor)
library(broom) # used to make tables
library(knitr) # used to make table
```

## Juvenile Salmo Salar 
![](http://www.ejpau.media.pl/articles/volume15/issue1/art-02_1.jpg)

#### Load in the data + clean it:
- Three species of fish
- The fish growth (g/day) for different concentrations of protein feed (kcal/pellet)

```{r}
fish_growth <- read_csv(here("data","fish_growth.csv"))

# use janitor() and clean up the names
fish <- fish_growth %>% clean_names()
```

QUESTION (1): Is the relationship of fish growth to protein concentration in the feed the same for each species?

- If the relationship of fish growth to protein concentration in the feed is NOT the same for each species ...

QUESTION (2): What is the formula to predict the average growth for different concentrations of protein for each species. 


NOTE: 
- use multiple linear regression 
- the starting mass:
      - 300 g for juvenile Salmo salar
      - 300 g for Oncorhynchus mykiss
      - 150 g for juvenile Oreochromis niloticus
- the fish were monitored in individual 25 liter holding tanks with flow through water systems for 7 days
- all fish survived the study except one (the Salmo salar individual fed a zero protein diet died after 4 days)


Scatterplot of the data
```{r fish_1, fig.align='center',fig.cap="Figure 1. Scatterplot of the relationship between each species' amount of protein received and their growth"}

fish_scatter <- ggplot(fish, aes(x = protein, y = growth, color = species)) +
  geom_point() +
  labs(x = "Protein (kcal/pellet)", y = "Growth (g/day)") +
  theme_minimal()

fish_scatter
```
From this scatterplot, we can see that there is a linear relationship between protein and the growth of the fish

Now, is there a different effect for the different species?



An aside about correlation
- Pearson, most common
  - looking at correlation between protein and growth of fish
  - is the correlation different than zero
  - "0" means that volume is not related to height at all
  - "1" perfectly positively correlated
  - "-1" perfectly negatively correlated

```{r, results=TRUE}
fish$protein <- as.numeric(fish$protein)
fish$growth <- as.numeric(fish$growth)
summary(fish)

cor.test(fish$protein, fish$growth, method = "pearson")
```

cor = 0.825091
This means that there is a substantial positive correlation between the amount of protein received and the growth of the fish



### Suite of Models

```{r}
m_0 <- lm(growth ~ 1, data=fish) # mean only model

m_1a <- lm(growth ~ protein, data=fish) # Simple linear regression

m_1b <- lm(growth ~ species, data=fish) # Simple linear regression

m_1c <- lm(growth ~ species + protein, data=fish) # Simple linear regression

m_1d <- lm(growth ~ species * protein, data=fish) # Simple linear regression

m_2a <- lm(growth ~ -1 + protein + I(protein^2), data=fish) # 2nd degree polynomial no constant (intercept)
## I = "as is" command
## run a command without actually changing or adding a variable to the data set

m_2a <- lm(growth ~ -1 + protein + I(protein^2), data=fish)

m_2b <- lm(growth ~ protein + I(protein^2), data=fish)

m_3 <- lm(growth ~ protein + I(protein^2) + I(protein^3), data=fish)


BIC_list <- c(BIC(m_0), BIC(m_1a), BIC(m_1b), BIC(m_1c), BIC(m_1d), BIC(m_2a), BIC(m_2b), BIC(m_3))

model_output <-rbind(data.frame(glance(m_0)),data.frame(glance(m_1a)),data.frame(glance(m_1b)),data.frame(glance(m_1c)),data.frame(glance(m_1d)),data.frame(glance(m_2a)),data.frame(glance(m_2b)), data.frame(glance(m_3))) %>% select(BIC) 

model_output <- mutate(model_output, delta.BIC = BIC-min(BIC_list))
model_output$model<-c("Model 0","Model 1a","Model 1b","Model 1c","Model 1d", "Model 2a","Model 2b", "Model 3")
model_output<-model_output[,c("model", "BIC", "delta.BIC" )]


kable(model_output, format = "markdown", digits = 3, caption = "BIC, and Delta.BIC for the IDF models. Delta BIC > 7 indicates models that should be dismissed from further consideration.")

```
Model 1d has the lowest BIC value (132.027), so it is the best model. It is showing the interaction between the species and the protein given, and the effect on growth of the fish

```{r}
m_1d <- lm(growth ~ species * protein, data=fish) # Simple linear regression

m_1d_out <- summary(m_1d)
m_1d_out
```


g = -1.92 + 0.05(protein) + 2.25(Sp.NIT) - 9.47(AS) - 0.034(Pro * Sp.NIT) + 0.03(protein * AS)


The equation for rainbow trout (the reference species)
g = -1.92 + 0.05(protein)

The equation for Oreochromis niloticus
g = -1.92 + 0.05(protein) + 2.25 - 9.47(AS) - 0.034(protein)
COMBINE FACTORS
g = 0.33 - 0.016(protein)

The equation for Salmo salar
g = -1.92 + 0.05(protein) - 9.47 + 0.03(protein)
COMBINE FACTORS
g = -11.39 + 0.08(protein)







Note from lab from Chris ---
- the growth can be negative, so we don't have much reason to force the intercept through zero
- one starts to plateau? at some point, the fish can't take in any more protein
- what about the fish that was starved? get rid of that data, and then re-run the model and see if anything changes (the two should stay the same!!)

- checking for outliers with single linear regression models
- cook's distance... is it an outlier? evaluate it in the model itself
    - does the intercept and slope change?
    
- what is the impact on y? think about the 500 acre feet water question from the quiz
